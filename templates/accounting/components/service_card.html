{% load presentation_tags service_tags service_status_tags accounting_tags %}
{% load tenant_tags %}

<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-md transition-shadow duration-200">
    <div class="p-6">
        <div class="flex items-start justify-between mb-4">
            <div class="flex items-center space-x-3 min-w-0 flex-1">
                <div class="flex-shrink-0">
                    <div class="h-12 w-12 rounded-full bg-gradient-to-br from-primary-100 to-primary-200 dark:from-primary-800 dark:to-primary-900 flex items-center justify-center">
                        <span class="text-lg font-semibold text-primary-700 dark:text-primary-300">
                            {{ service.client.full_name|first|upper }}
                        </span>
                    </div>
                </div>
                
                <div class="min-w-0 flex-1">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white truncate">
                        {{ service.client.full_name }}
                    </h3>
                    {% if service.client.email %}
                    <p class="text-sm text-gray-500 dark:text-gray-400 truncate">
                        {{ service.client.email }}
                    </p>
                    {% endif %}
                </div>
            </div>
            
            <div class="flex-shrink-0 text-right">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800 dark:bg-primary-800 dark:text-primary-200">
                    {{ service.get_category_display }}
                </span>
            </div>
        </div>
        
        <div class="space-y-4">
            <div class="p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                <div class="text-sm">
                    <span class="text-primary-600 dark:text-primary-400 font-medium">Línea:</span>
                    <span class="text-primary-900 dark:text-primary-100 ml-1 font-semibold">
                        {{ service.business_line.name }}
                    </span>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-3">
                <div class="text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                    <div class="text-lg font-bold text-blue-900 dark:text-blue-100">
                        {{ service.price|format_currency:"€" }}
                    </div>
                    <div class="text-xs text-blue-700 dark:text-blue-300">
                        Precio
                    </div>
                </div>
                
                <div class="text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                    <div class="text-lg font-bold text-green-900 dark:text-green-100">
                        {{ service.total_paid|format_currency:"€" }}
                    </div>
                    <div class="text-xs text-green-700 dark:text-green-300">
                        Pagado
                    </div>
                </div>
            </div>
            
            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg space-y-2">
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400">Estado Operacional:</span>
                    {% service_operational_status_badge service %}
                </div>
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400">Estado Pagos:</span>
                    {% service_payment_status_badge service %}
                </div>
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400">Estado Renovación:</span>
                    {% service_renewal_status_badge service %}
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-3 text-sm">
                <div>
                    <span class="text-gray-600 dark:text-gray-400">Inicio:</span>
                    <div class="font-medium text-gray-900 dark:text-white">
                        {{ service.start_date|date:"d/m/Y" }}
                    </div>
                </div>
                <div>
                    <span class="text-gray-600 dark:text-gray-400">Activo hasta:</span>
                    <div class="font-medium text-gray-900 dark:text-white">
                        {% service_effective_end_date service as effective_date %}
                        {{ effective_date|date:"d/m/Y"|default:"Sin definir" }}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="space-y-3">
            {% include 'accounting/components/notes_display.html' with notes=service.client.notes title="Notas del Cliente" max_words=15 %}
            {% include 'accounting/components/notes_display.html' with notes=service.notes title="Notas del Servicio" max_words=15 %}
        </div>
        
        <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-600">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <a href="{% tenant_url 'accounting:client-service-history' client_id=service.client.id %}"
                       class="text-sm text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300 font-medium">
                        Historial
                    </a>
                    {% if service|service_is_active or service|service_is_expired %}
                    <a href="{% tenant_url 'accounting:service-payment' service_id=service.id %}"
                       class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium">
                        Pagar
                    </a>
                    <a href="{% tenant_url 'accounting:service-renewal' service_id=service.id %}"
                       class="text-sm text-purple-600 dark:text-purple-400 hover:text-purple-800 dark:hover:text-purple-300 font-medium">
                        Renovar
                    </a>
                    {% endif %}
                    {% should_show_reactivation_option service.client as show_reactivation %}
                    {% if show_reactivation %}
                    <a href="{% get_reactivation_url service %}"
                       class="text-sm text-orange-600 dark:text-orange-400 hover:text-orange-800 dark:hover:text-orange-300 font-medium">
                        Nuevo Servicio
                    </a>
                    {% endif %}
                </div>
                <div class="flex items-center space-x-3">
                    <a href="{% get_service_edit_url service %}"
                       class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium">
                        Editar
                    </a>
                    {% if service|service_can_terminate %}
                    <a href="{% get_service_termination_url service %}"
                       class="text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 font-medium">
                        Finalizar
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
